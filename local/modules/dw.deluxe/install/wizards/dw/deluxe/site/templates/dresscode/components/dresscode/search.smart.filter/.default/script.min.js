function JCSmartFilter(t,e,i){this.ajaxURL=t,this.form=null,this.timer=null,this.cacheKey="",this.cache=[],this.viewMode=e,i&&i.SEF_SET_FILTER_URL&&(this.bindUrlToButton("set_filter",i.SEF_SET_FILTER_URL),this.sef=!0),i&&i.SEF_DEL_FILTER_URL&&this.bindUrlToButton("del_filter",i.SEF_DEL_FILTER_URL)}JCSmartFilter.prototype.keyup=function(t){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate(function(){this.reload(t)},this),500)},JCSmartFilter.prototype.click=function(t){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate(function(){this.reload(t)},this),500)},JCSmartFilter.prototype.reload=function(t){if(""!==this.cacheKey)this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate(function(){this.reload(t)},this),1e3);else if(this.cacheKey="|",this.position=BX.pos(t,!0),this.form=BX.findParent(t,{tag:"form"}),this.form){var e=[{name:"ajax",value:"y"}];this.gatherInputsValues(e,BX.findChildren(this.form,{tag:new RegExp("^(input|select)$","i")},!0));for(var i=0;i<e.length;i++)this.cacheKey+=e[i].name+":"+e[i].value+"|";this.cache[this.cacheKey]?(this.curFilterinput=t,this.postHandler(this.cache[this.cacheKey],!0)):(this.sef&&(BX("set_filter").disabled=!0),this.curFilterinput=t,BX.ajax.loadJSON(this.ajaxURL,this.values2post(e),BX.delegate(this.postHandler,this)))}},JCSmartFilter.prototype.updateItem=function(t,e){if("N"===e.PROPERTY_TYPE||e.PRICE){t=window["trackBar"+t];(t=!t&&e.ENCODED_ID?window["trackBar"+e.ENCODED_ID]:t)&&e.VALUES&&(e.VALUES.MIN&&(e.VALUES.MIN.FILTERED_VALUE?t.setMinFilteredValue(e.VALUES.MIN.FILTERED_VALUE):t.setMinFilteredValue(e.VALUES.MIN.VALUE)),e.VALUES.MAX)&&(e.VALUES.MAX.FILTERED_VALUE?t.setMaxFilteredValue(e.VALUES.MAX.FILTERED_VALUE):t.setMaxFilteredValue(e.VALUES.MAX.VALUE))}else if(e.VALUES)for(var i in e.VALUES){var r,n,s;e.VALUES.hasOwnProperty(i)&&(i=e.VALUES[i],r=BX(i.CONTROL_ID))&&(n=document.querySelector('[data-role="label_'+i.CONTROL_ID+'"]'),s=document.getElementById(i.CONTROL_ID),i.DISABLED?(n?BX.addClass(n,"disabled"):BX.addClass(r.parentNode,"disabled"),BX.adjust(s,{props:{disabled:!0}})):(n?BX.removeClass(n,"disabled"):BX.removeClass(r.parentNode,"disabled"),BX.adjust(s,{props:{disabled:!1}})),i.hasOwnProperty("ELEMENT_COUNT"))&&(n=document.querySelector('[data-role="count_'+i.CONTROL_ID+'"]'))&&(n.innerHTML="("+i.ELEMENT_COUNT+")")}},JCSmartFilter.prototype.postHandler=function(e,t){var i,r=BX("modef"),n=BX("modef_num"),s=BX("set_filter_num");if(e&&e.ITEMS){for(var l in e.ITEMS)e.ITEMS.hasOwnProperty(l)&&this.updateItem(l,e.ITEMS[l]);r&&n&&(n.innerHTML=e.ELEMENT_COUNT,s.innerHTML="("+e.ELEMENT_COUNT+")",n=BX.findChildren(r,{tag:"A"},!0),e.FILTER_URL&&n&&(n[0].href=BX.util.htmlspecialcharsback(e.FILTER_URL)),e.FILTER_AJAX_URL&&e.COMPONENT_CONTAINER_ID&&BX.bind(n[0],"click",function(t){return i=BX.util.htmlspecialcharsback(e.FILTER_AJAX_URL),BX.ajax.insertToNode(i,e.COMPONENT_CONTAINER_ID),BX.PreventDefault(t)}),e.INSTANT_RELOAD&&e.COMPONENT_CONTAINER_ID?(i=BX.util.htmlspecialcharsback(e.FILTER_AJAX_URL),BX.ajax.insertToNode(i,e.COMPONENT_CONTAINER_ID)):("none"===r.style.display&&(r.style.display="inline-block"),this.viewMode,e.SEF_SET_FILTER_URL&&this.bindUrlToButton("set_filter",e.SEF_SET_FILTER_URL)))}this.sef&&(BX("set_filter").disabled=!1),t||""===this.cacheKey||(this.cache[this.cacheKey]=e),this.cacheKey=""},JCSmartFilter.prototype.bindUrlToButton=function(t,e){var i,r,t=BX(t);t&&("submit"==t.type&&(t.type="button"),BX.bind(t,"click",(i=e,r=function(t){return window.location.href=t,!1},function(){return r(i)})))},JCSmartFilter.prototype.gatherInputsValues=function(t,e){if(e)for(var i=0;i<e.length;i++){var r=e[i],n=$(r);if(Number(n.data("val"))!=Number(n.val())&&(!r.disabled&&r.type))switch(r.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":r.value.length&&(t[t.length]={name:r.name,value:r.value});break;case"radio":case"checkbox":r.checked&&(t[t.length]={name:r.name,value:r.value});break;case"select-multiple":for(var s=0;s<r.options.length;s++)r.options[s].selected&&(t[t.length]={name:r.name,value:r.options[s].value})}}},JCSmartFilter.prototype.values2post=function(t){for(var e=[],i=e,r=0;r<t.length;){var n,s,l=t[r].name.indexOf("[");-1==l?(i[t[r].name]=t[r].value,i=e,r++):(n=t[r].name.substring(0,l),l=t[r].name.substring(l+1),i[n]||(i[n]=[]),-1==(s=l.indexOf("]"))?(i=e,r++):0==s?(i=i[n],t[r].name=""+i.length):(i=i[n],t[r].name=l.substring(0,s)+l.substring(s+1)))}return e},JCSmartFilter.prototype.hideFilterProps=function(t){var e,i=t.parentNode,r=i.querySelector("[data-role='bx_filter_block']"),t=i.querySelector("[data-role='prop_angle']");BX.hasClass(i,"bx-active")?(new BX.easing({duration:300,start:{opacity:1,height:r.offsetHeight},finish:{opacity:0,height:0},transition:BX.easing.transitions.quart,step:function(t){r.style.opacity=t.opacity,r.style.height=t.height+"px"},complete:function(){r.setAttribute("style",""),BX.removeClass(i,"bx-active")}}).animate(),BX.addClass(t,"fa-angle-down"),BX.removeClass(t,"fa-angle-up")):(r.style.display="block",r.style.opacity=0,r.style.height="auto",e=r.offsetHeight,r.style.height=0,new BX.easing({duration:300,start:{opacity:0,height:0},finish:{opacity:1,height:e},transition:BX.easing.transitions.quart,step:function(t){r.style.opacity=t.opacity,r.style.height=t.height+"px"},complete:function(){}}).animate(),BX.addClass(i,"bx-active"),BX.removeClass(t,"fa-angle-down"),BX.addClass(t,"fa-angle-up"))},JCSmartFilter.prototype.showDropDownPopup=function(t,e){var i=t.querySelector('[data-role="dropdownContent"]');BX.PopupWindowManager.create("smartFilterDropDown"+e,t,{autoHide:!0,offsetLeft:0,offsetTop:3,overlay:!1,draggable:{restrict:!0},closeByEsc:!0,content:i}).show()},JCSmartFilter.prototype.selectDropDownItem=function(t,e){},BX.namespace("BX.Iblock.SmartFilter"),BX.Iblock.SmartFilter=(()=>{function t(t){"object"==typeof t&&(this.leftSlider=BX(t.leftSlider),this.rightSlider=BX(t.rightSlider),this.tracker=BX(t.tracker),this.trackerWrap=BX(t.trackerWrap),this.minInput=BX(t.minInputId),this.maxInput=BX(t.maxInputId),this.minPrice=parseFloat(t.minPrice),this.maxPrice=parseFloat(t.maxPrice),this.curMinPrice=parseFloat(t.curMinPrice),this.curMaxPrice=parseFloat(t.curMaxPrice),this.fltMinPrice=t.fltMinPrice?parseFloat(t.fltMinPrice):parseFloat(t.curMinPrice),this.fltMaxPrice=t.fltMaxPrice?parseFloat(t.fltMaxPrice):parseFloat(t.curMaxPrice),this.precision=t.precision||0,this.priceDiff=this.maxPrice-this.minPrice,this.leftPercent=0,this.rightPercent=0,this.fltMinPercent=0,this.fltMaxPercent=0,this.colorUnavailableActive=BX(t.colorUnavailableActive),this.colorAvailableActive=BX(t.colorAvailableActive),this.colorAvailableInactive=BX(t.colorAvailableInactive),this.isTouch=!1,this.init(),"ontouchstart"in document.documentElement?(this.isTouch=!0,BX.bind(this.leftSlider,"touchstart",BX.proxy(function(t){this.onMoveLeftSlider(t)},this)),BX.bind(this.rightSlider,"touchstart",BX.proxy(function(t){this.onMoveRightSlider(t)},this))):(BX.bind(this.leftSlider,"mousedown",BX.proxy(function(t){this.onMoveLeftSlider(t)},this)),BX.bind(this.rightSlider,"mousedown",BX.proxy(function(t){this.onMoveRightSlider(t)},this))),BX.bind(this.minInput,"keyup",BX.proxy(function(t){this.onInputChange()},this)),BX.bind(this.maxInput,"keyup",BX.proxy(function(t){this.onInputChange()},this)))}return t.prototype.init=function(){var t;this.curMinPrice>this.minPrice&&(t=this.curMinPrice-this.minPrice,this.leftPercent=100*t/this.priceDiff,this.leftSlider.style.left=this.leftPercent+"%",this.colorUnavailableActive.style.left=this.leftPercent+"%"),this.setMinFilteredValue(this.fltMinPrice),this.curMaxPrice<this.maxPrice&&(t=this.maxPrice-this.curMaxPrice,this.rightPercent=100*t/this.priceDiff,this.rightSlider.style.right=this.rightPercent+"%",this.colorUnavailableActive.style.right=this.rightPercent+"%"),this.setMaxFilteredValue(this.fltMaxPrice)},t.prototype.setMinFilteredValue=function(t){this.fltMinPrice=parseFloat(t),this.fltMinPrice>=this.minPrice?(t=this.fltMinPrice-this.minPrice,this.fltMinPercent=100*t/this.priceDiff,this.leftPercent>this.fltMinPercent?this.colorAvailableActive.style.left=this.leftPercent+"%":this.colorAvailableActive.style.left=this.fltMinPercent+"%",this.colorAvailableInactive.style.left=this.fltMinPercent+"%"):(this.colorAvailableActive.style.left="0%",this.colorAvailableInactive.style.left="0%")},t.prototype.setMaxFilteredValue=function(t){this.fltMaxPrice=parseFloat(t),this.fltMaxPrice<=this.maxPrice?(t=this.maxPrice-this.fltMaxPrice,this.fltMaxPercent=100*t/this.priceDiff,this.rightPercent>this.fltMaxPercent?this.colorAvailableActive.style.right=this.rightPercent+"%":this.colorAvailableActive.style.right=this.fltMaxPercent+"%",this.colorAvailableInactive.style.right=this.fltMaxPercent+"%"):(this.colorAvailableActive.style.right="0%",this.colorAvailableInactive.style.right="0%")},t.prototype.getXCoord=function(t){var t=t.getBoundingClientRect(),e=document.body,i=document.documentElement,r=window.pageXOffset||i.scrollLeft||e.scrollLeft,i=i.clientLeft||e.clientLeft||0,e=t.left+r-i;return Math.round(e)},t.prototype.getPageX=function(t){t=t||window.event;var e,i,r=null;return this.isTouch&&null!=event.targetTouches[0]?r=t.targetTouches[0].pageX:null!=t.pageX?r=t.pageX:null!=t.clientX&&(e=document.documentElement,i=document.body,r=t.clientX+(e.scrollLeft||i&&i.scrollLeft||0),r-=e.clientLeft||0),r},t.prototype.recountMinPrice=function(){var t=this.priceDiff*this.leftPercent/100;(t=(this.minPrice+t).toFixed(this.precision))!=this.minPrice?this.minInput.value=t:this.minInput.value="",smartFilter.keyup(this.minInput)},t.prototype.recountMaxPrice=function(){var t=this.priceDiff*this.rightPercent/100;(t=(this.maxPrice-t).toFixed(this.precision))!=this.maxPrice?this.maxInput.value=t:this.maxInput.value="",smartFilter.keyup(this.maxInput)},t.prototype.onInputChange=function(){var t,e;this.minInput.value&&(t=(t=(t=(t=this.minInput.value)<this.minPrice?this.minPrice:t)>this.maxPrice?this.maxPrice:t)-this.minPrice,this.leftPercent=100*t/this.priceDiff,this.makeLeftSliderMove(!1)),this.maxInput.value&&((e=(e=this.maxInput.value)<this.minPrice?this.minPrice:e)>this.maxPrice&&(e=this.maxPrice),t=this.maxPrice-e,this.rightPercent=100*t/this.priceDiff,this.makeRightSliderMove(!1))},t.prototype.makeLeftSliderMove=function(t){t=!1!==t,this.leftSlider.style.left=this.leftPercent+"%",this.colorUnavailableActive.style.left=this.leftPercent+"%";var e=!1;100<=this.leftPercent+this.rightPercent&&(e=!0,this.rightPercent=100-this.leftPercent,this.rightSlider.style.right=this.rightPercent+"%",this.colorUnavailableActive.style.right=this.rightPercent+"%"),this.leftPercent>=this.fltMinPercent&&this.leftPercent<=100-this.fltMaxPercent?(this.colorAvailableActive.style.left=this.leftPercent+"%",e&&(this.colorAvailableActive.style.right=100-this.leftPercent+"%")):this.leftPercent<=this.fltMinPercent?(this.colorAvailableActive.style.left=this.fltMinPercent+"%",e&&(this.colorAvailableActive.style.right=100-this.fltMinPercent+"%")):this.leftPercent>=this.fltMaxPercent&&(this.colorAvailableActive.style.left=100-this.fltMaxPercent+"%",e)&&(this.colorAvailableActive.style.right=this.fltMaxPercent+"%"),t&&(this.recountMinPrice(),e)&&this.recountMaxPrice()},t.prototype.countNewLeft=function(t){var t=this.getPageX(t),e=this.getXCoord(this.trackerWrap),i=this.trackerWrap.offsetWidth,t=t-e;return t<0?t=0:i<t&&(t=i),t},t.prototype.onMoveLeftSlider=function(t){return this.isTouch||(this.leftSlider.ondragstart=function(){return!1}),this.isTouch?(document.ontouchmove=BX.proxy(function(t){this.leftPercent=100*this.countNewLeft(t)/this.trackerWrap.offsetWidth,this.makeLeftSliderMove()},this),document.ontouchend=function(){document.ontouchmove=document.touchend=null}):(document.onmousemove=BX.proxy(function(t){this.leftPercent=100*this.countNewLeft(t)/this.trackerWrap.offsetWidth,this.makeLeftSliderMove()},this),document.onmouseup=function(){document.onmousemove=document.onmouseup=null}),!1},t.prototype.makeRightSliderMove=function(t){t=!1!==t,this.rightSlider.style.right=this.rightPercent+"%",this.colorUnavailableActive.style.right=this.rightPercent+"%";var e=!1;100<=this.leftPercent+this.rightPercent&&(e=!0,this.leftPercent=100-this.rightPercent,this.leftSlider.style.left=this.leftPercent+"%",this.colorUnavailableActive.style.left=this.leftPercent+"%"),100-this.rightPercent>=this.fltMinPercent&&this.rightPercent>=this.fltMaxPercent?(this.colorAvailableActive.style.right=this.rightPercent+"%",e&&(this.colorAvailableActive.style.left=100-this.rightPercent+"%")):this.rightPercent<=this.fltMaxPercent?(this.colorAvailableActive.style.right=this.fltMaxPercent+"%",e&&(this.colorAvailableActive.style.left=100-this.fltMaxPercent+"%")):100-this.rightPercent<=this.fltMinPercent&&(this.colorAvailableActive.style.right=100-this.fltMinPercent+"%",e)&&(this.colorAvailableActive.style.left=this.fltMinPercent+"%"),t&&(this.recountMaxPrice(),e)&&this.recountMinPrice()},t.prototype.onMoveRightSlider=function(t){return this.isTouch||(this.rightSlider.ondragstart=function(){return!1}),this.isTouch?(document.ontouchmove=BX.proxy(function(t){this.rightPercent=100-100*this.countNewLeft(t)/this.trackerWrap.offsetWidth,this.makeRightSliderMove()},this),document.ontouchend=function(){document.ontouchmove=document.ontouchend=null}):(document.onmousemove=BX.proxy(function(t){this.rightPercent=100-100*this.countNewLeft(t)/this.trackerWrap.offsetWidth,this.makeRightSliderMove()},this),document.onmouseup=function(){document.onmousemove=document.onmouseup=null}),!1},t})(),JCSmartFilter.prototype.selectDropDownItem=function(t,e){$(t).parent().hasClass("disabled")||this.keyup(BX(e))};var openDropdownList=function(t){$(this).siblings(".dropdownList").toggleClass("opened")},selectItem=function(t){var e=$(this);e.parent().addClass("selected").siblings().removeClass("selected").parent().siblings(".checkedItem").html(e.html()),closeList()},closeList=function(t){$("#smartFilter .dropdownList").removeClass("opened")},showHint=function(t){$(this).find(".hintValue").toggle(),t.stopImmediatePropagation()},closeHint=function(t){$(".hintValue").hide(),t.stopPropagation()},showAllParams=function(t){var e=$(this),i=e.parents("li").siblings("li");0<i.filter(".off").length?(i.removeClass("off"),e.html(SMART_FILTER_LANG.HIDE_ALL+" "+(i.length-5))):(i.slice(5).addClass("off"),e.html(SMART_FILTER_LANG.SHOW_ALL+" "+(i.length-5))),t.preventDefault()};$(window).on("load",function(){var t=$("#smartFilter input"),e=$("#smartFilterForm"),i=$("#modef");t.on("change",function(){var t=$(this),t=t.offset().top-t.height()/2;i.css("top",t-$("#smartFilter").offset().top)}),$("#set_filter, #modef_send").on("click",function(t){$(".rangeSlider").each(function(t,e){$(e).find("input").each(function(t,e){e=$(e);parseInt(e.data("val"))==parseInt(e.val())&&e.prop("disabled",!0)})}),e.append('<input type="hidden" name="set_filter" value="Y">').submit(),t.preventDefault()}),$("#del_filter").on("click",function(t){e.append('<input type="hidden" name="del_filter" value="Y">').submit(),t.preventDefault()}),i.find(".close").on("click",function(t){$(this).parent().hide(),t.preventDefault()}),$(".propExpander").on("click",function(){$(this).toggleClass("expanded").siblings(".params").toggleClass("collapsed")}),$(".paramsBoxTitle span").on("click",function(){$(this).parents(".paramsBoxTitle").siblings(".propExpander").toggleClass("expanded").siblings(".params").toggleClass("collapsed")}),$(document).on("click","",closeHint),$(document).on("click","",closeList),$(document).on("click","#smartFilter .showALL",showAllParams),$(document).on("click","#smartFilter .hint",showHint),$(document).on("click","#smartFilter .hint .close",closeHint),$(document).on("click","#smartFilter .checkedItem",openDropdownList),$(document).on("click","#smartFilter .dropdown li:not('.disabled') .item",selectItem),$(document).on("click","#smartFilter .hint",function(t){t.stopImmediatePropagation()}),$(document).on("click",".dropdown",function(t){t.stopImmediatePropagation()})});