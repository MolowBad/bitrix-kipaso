class DwComponentLoader{#spinner;#spinnerActiveClass;constructor(e){if(!e)throw new Error("Cannot create loader without parameters");if(!e.spinnerSelector)throw new Error("Cannot create loader without spinnerSelector in parameters");if(!e.spinnerActiveClass)throw new Error("Cannot create loader without spinnerActiveClass in parameters");if(this.#spinner=document.querySelector(e.spinnerSelector),!this.#spinner)throw new Error("Cannot find spinner element: "+e.spinnerSelector);this.#spinnerActiveClass=e.spinnerActiveClass}async load(e){if(!(e instanceof Request))throw new Error("Cannot load component without Request object");this.#showSpinner();try{var s=await this.#sendRequest(e),t=await this.#parseResponse(s);await this.#loadAssets(t),this.#insert(t)}finally{this.#hideSpinner()}}async#sendRequest(e){e=await fetch(e);if(e.ok)return e;throw{message:"Cannot fetch component: HTTP "+e.status,reasons:["HTTP error: "+e.status],status:e.status}}async#parseResponse(e){e=await e.json();if(e.errors&&0<e.errors.length)throw{message:"Cannot load component: API returned errors",reasons:e.errors,response:e};if("success"!==e.status||!e.data)throw{message:"Cannot parse response: invalid format",reasons:["Invalid response format"],response:e};if(e.data.html)return e.data;throw{message:"Cannot render component: no HTML content",reasons:["Missing HTML content in response"],response:e}}async#loadAssets(e){var s;e.assets&&(s=Array.isArray(e?.assets?.js)?e.assets.js:[],e=Array.isArray(e?.assets?.css)?e.assets.css:[],await Promise.all([this.#loadScripts(...s),this.#loadStyles(...e)]))}async#loadScripts(...e){e=e.map(e=>this.#loadScript(e));return Promise.all(e)}async#loadStyles(...e){e=e.map(e=>this.#loadStyle(e));return Promise.all(e)}#loadScript(r){return this.#hasScript(r)?Promise.resolve():new Promise((e,s)=>{var t=document.createElement("script");t.src=r,t.onload=e,t.onerror=()=>s({message:"Cannot load script: "+r,reasons:["Failed to load script: "+r]}),document.head.appendChild(t)})}#loadStyle(r){return this.#hasStyle(r)?Promise.resolve():new Promise((e,s)=>{var t=document.createElement("link");t.rel="stylesheet",t.href=r,t.onload=e,t.onerror=()=>s({message:"Cannot load stylesheet: "+r,reasons:["Failed to load stylesheet: "+r]}),document.head.appendChild(t)})}#hasScript(e){return null!==document.querySelector(`script[src="${e}"]`)}#hasStyle(e){return null!==document.querySelector(`link[href="${e}"]`)}#insert(e){e=document.createRange().createContextualFragment(e.html);document.body.appendChild(e)}#showSpinner(){this.#spinner.classList.add(this.#spinnerActiveClass)}#hideSpinner(){this.#spinner.classList.remove(this.#spinnerActiveClass)}}