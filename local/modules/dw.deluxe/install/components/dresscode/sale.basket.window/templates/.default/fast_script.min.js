$(function(){var e=$("#foundation"),s=0,o=$(document);var c={binding:{keypress:{},change:{},click:{},keyup:{}},tools:{},commit:{},ajax:{}},a=(c.binding.click.deleteItem=function(t){var e=$(this).data("id");return c.commit.deleteProduct(e),t.preventDefault()},c.binding.click.closeWindow=function(t){return $self=$("#appBasket"),$.each(a,function(a,t){$.each(t,function(t,e){o.off(a,t,e)})}),$self.remove(),e.removeClass("blurred"),t.preventDefault()},c.binding.click.quantityMinus=function(t){var e=$(this).parents(".qtyBlock").find(".qty"),a=parseFloat(e.data("ratio")),o=parseFloat(e.val());return a<o&&(e.val(+(o-a).toFixed(5)),e.trigger("change")),t.preventDefault()},c.binding.click.quantityPlus=function(t){var e=$(this).parents(".qtyBlock").find(".qty"),a=parseFloat(e.data("ratio")),a=parseFloat(e.val())+a;return e.val(+a.toFixed(5)),e.trigger("change"),t.preventDefault()},c.binding.change.quantity=function(t){var e=$(this),a=e.data("id"),o=parseFloat(e.data("max-quantity")),n=parseFloat(e.data("ratio")),i=parseFloat(e.val()),r=+(i/n).toFixed(5);c.tools.removeError(e),o<i?(i=o,e.val(i),c.tools.addError(e)):(isNaN(i)||i<n?i=n:(0^r)!=r?i=Math.ceil(i/n)*n:e.data("last-value",i),e.val(i)),clearTimeout(s),s=setTimeout(function(){c.commit.updateProduct(a,i)},400)},c.commit.updateProduct=function(t,e){var a,o;"number"==typeof t&&"number"==typeof e?(a=$("#appBasket"),(o=new FormData).append("actionType","updateQuantity"),o.append("basketId",t),o.append("quantity",e),o.append("hide-measures",a.data("hide-measures")),o.append("siteId",appBasketSiteId),c.tools.launchLoader(a),c.ajax.sendData(appBasketAjaxDir+"/ajax.php",o,"post","json",function(t){!0===t.status?c.commit.proccesing(t):!0===t.error&&console.error(t);c.tools.stopLoader(a)},!1)):console.error("check transmitted data")},c.commit.deleteProduct=function(t){var a,e;"number"==typeof t?(a=$("#appBasket"),(e=new FormData).append("actionType","removeItem"),e.append("basketId",t),e.append("siteId",appBasketSiteId),c.tools.launchLoader(a),c.ajax.sendData(appBasketAjaxDir+"/ajax.php",e,"post","json",function(t){{var e;!0===t.status?(e=$(".bwOpened").removeClass("added").attr("href","#"),$("#appBasket .closeWindow").trigger("click"),"undefined"!=typeof lastAddCartText&&""!=lastAddCartText&&e.html(lastAddCartText),cartReload()):!0===t.error&&console.error(t)}c.tools.stopLoader(a)},!1)):console.error("check transmitted data")},c.commit.proccesing=function(t){var e,a,o;void 0!==t.compilation&&void 0!==t.compilation.item&&(e=(a=$("#appBasket")).find(".allSum"),a=a.find(".price"),o=t.compilation.item,e.html(""),a.html(""),a.append($("<span/>",{class:"priceContainer"}).html(o.PRICE_FORMATED)),void 0===t.compilation.measures||$.isEmptyObject(t.compilation.measures)||void 0!==o.CATALOG_MEASURE&&""!=o.CATALOG_MEASURE&&null!=o.CATALOG_MEASURE&&a.append($("<span/>",{class:"measure"}).html(" / "+t.compilation.measures[o.CATALOG_MEASURE].SYMBOL_RUS)),e.append(o.SUM_FORMATED),0<parseFloat(o.DISCOUNT)&&(a.append(" ").append($("<s/>",{class:"discount"}).html(o.BASE_PRICE_FORMATED)),e.append($("<s/>",{class:"discount"}).html(o.BASE_SUM_FORMATED))),cartReload())},c.ajax.sendData=function(t,e,a,o,n,i=!1){$.ajax({dataType:o,processData:!1,contentType:!1,cache:!1,url:t,type:a,data:e,success:n,beforeSend:function(t,e){c.tools.launchLoader(i)},complete:function(t,e){c.tools.stopLoader(i)},error:function(t,e,a){console.error({httpResponse:t.responseText,status:t.statusText}),console.error(t,e,a)}})},c.tools.launchLoader=function(t,e="loading"){if("object"==typeof t)return t.addClass(e)},c.tools.stopLoader=function(t,e="loading"){if("object"==typeof t)return t.removeClass(e)},c.tools.addError=function(t,e="error"){if("object"==typeof t)return t.addClass(e)},c.tools.removeError=function(t,e="error"){if("object"==typeof t)return t.removeClass(e)},{click:{"#appBasket .closeWindow":c.binding.click.closeWindow,"#appBasket .delete":c.binding.click.deleteItem,"#appBasket .minus":c.binding.click.quantityMinus,"#appBasket .plus":c.binding.click.quantityPlus},keypress:{"#appBasket .qty":c.binding.keypress.quantity},change:{"#appBasket .qty":c.binding.change.quantity}});$.each(a,function(a,t){$.each(t,function(t,e){o.on(a,t,e)})})});