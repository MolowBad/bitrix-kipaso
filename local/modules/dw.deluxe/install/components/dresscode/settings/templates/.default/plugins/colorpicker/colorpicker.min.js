(a=>{e={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!(o=65)},r=function(e,o){e=y(e);a(o).data("colorpicker").fields.eq(1).val(e.r).end().eq(2).val(e.g).end().eq(3).val(e.b).end()},i=function(e,o){a(o).data("colorpicker").fields.eq(4).val(e.h).end().eq(5).val(e.s).end().eq(6).val(e.b).end()},n=function(e,o){a(o).data("colorpicker").fields.eq(0).val(M(e)).end()},c=function(e,o){a(o).data("colorpicker").selector.css("backgroundColor","#"+M({h:e.h,s:100,b:100})),a(o).data("colorpicker").selectorIndic.css({left:parseInt(150*e.s/100,10),top:parseInt(150*(100-e.b)/100,10)})},l=function(e,o){a(o).data("colorpicker").hue.css("top",parseInt(150-150*e.h/360,10))},d=function(e,o){a(o).data("colorpicker").newColor.css("backgroundColor","#"+M(e))},s=function(e){var o,t=a(this).parent().parent();0<this.parentNode.className.indexOf("_hex")?t.data("colorpicker").color=o=x(_(this.value)):0<this.parentNode.className.indexOf("_hsb")?t.data("colorpicker").color=o=k({h:parseInt(t.data("colorpicker").fields.eq(4).val(),10),s:parseInt(t.data("colorpicker").fields.eq(5).val(),10),b:parseInt(t.data("colorpicker").fields.eq(6).val(),10)}):t.data("colorpicker").color=o=w(b({r:parseInt(t.data("colorpicker").fields.eq(1).val(),10),g:parseInt(t.data("colorpicker").fields.eq(2).val(),10),b:parseInt(t.data("colorpicker").fields.eq(3).val(),10)})),e&&(r(o,t.get(0)),n(o,t.get(0)),i(o,t.get(0))),c(o,t.get(0)),l(o,t.get(0)),d(o,t.get(0)),t.data("colorpicker").onChange.apply(t.data("colorpicker"),[o,M(o),y(o)])},t=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10)))),e.data.preview&&s.apply(e.data.field.get(0),[!0]),!1},p=function(e){return s.apply(e.data.field.get(0),[!0]),e.data.el.removeClass("colorpicker_slider").find("input").focus(),a(document).unbind("mouseup",p),a(document).unbind("mousemove",t),!1},u=function(e){return s.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10)).get(0),[e.data.preview]),!1},h=function(e){return r(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),n(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),a(document).unbind("mouseup",h),a(document).unbind("mousemove",u),!1},f=function(e){return s.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10)).get(0),[e.data.preview]),!1},m=function(e){return r(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),n(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),a(document).unbind("mouseup",m),a(document).unbind("mousemove",f),!1},v=function(e){g(e.data.cal.get(0),e.target,e.data.cal.get(0))||(0!=e.data.cal.data("colorpicker").onHide.apply(this,[e.data.cal.get(0)])&&e.data.cal.hide(),a(document).unbind("mousedown",v))},g=function(e,o,t){if(e==o)return!0;if(e.contains)return e.contains(o);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(o));for(var r=o.parentNode;r&&r!=t;){if(r==e)return!0;r=r.parentNode}return!1},k=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},b=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},_=function(e){var o=6-e.length;if(0<o){for(var t=[],r=0;r<o;r++)t.push("0");t.push(e),e=t.join("")}return e},x=function(e){return w(B(e))},w=function(e){var o={h:0,s:0,b:0},t=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),t=r-t;return o.b=r,o.s=0!=r?255*t/r:0,0!=o.s?e.r==r?o.h=(e.g-e.b)/t:e.g==r?o.h=2+(e.b-e.r)/t:o.h=4+(e.r-e.g)/t:o.h=-1,o.h*=60,o.h<0&&(o.h+=360),o.s*=100/255,o.b*=100/255,o},y=function(e){var o,t={},r=Math.round(e.h),i=Math.round(255*e.s/100),e=Math.round(255*e.b/100);return 0==i?t.r=t.g=t.b=e:(e=r%60*((o=e)-(i=(255-i)*e/255))/60,(r=360==r?0:r)<60?(t.r=o,t.b=i,t.g=i+e):r<120?(t.g=o,t.b=i,t.r=o-e):r<180?(t.g=o,t.r=i,t.b=i+e):r<240?(t.b=o,t.r=i,t.g=o-e):r<300?(t.b=o,t.g=i,t.r=i+e):r<360?(t.r=o,t.g=i,t.b=o-e):(t.r=0,t.g=0,t.b=0)),{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},C=function(e){var t=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];return a.each(t,function(e,o){1==o.length&&(t[e]="0"+o)}),t.join("")},M=function(e){return C(y(e))};var o,e,r,i,n,c,l,d,s,t,p,u,h,f,m,v,g,k,b,_,x,w,y,C,M,I={init:function(t){if("string"==typeof(t=a.extend({},e,t||{})).color)t.color=x(t.color);else if(null!=t.color.r&&null!=t.color.g&&null!=t.color.b)t.color=w(t.color);else{if(null==t.color.h||null==t.color.s||null==t.color.b)return this;t.color=k(t.color)}return this.each(function(){var e,o;a(this).data("colorpickerId")||((e=a.extend({},t)).origColor=t.color,o="collorpicker_"+parseInt(1e3*Math.random()),a(this).data("colorpickerId",o),o=a('<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>').attr("id",o),e.flat?o.appendTo(this).show():o.appendTo(document.body),e.fields=o.find("input").bind("keyup",P).bind("change",s).bind("blur",N).bind("focus",S),o.find("span").bind("mousedown",O).end().find(">div.colorpicker_current_color").bind("click",D),e.selector=o.find("div.colorpicker_color").bind("mousedown",H),e.selectorIndic=e.selector.find("div div"),e.el=this,e.hue=o.find("div.colorpicker_hue div"),o.find("div.colorpicker_hue").bind("mousedown",z),e.newColor=o.find("div.colorpicker_new_color"),e.currentColor=o.find("div.colorpicker_current_color"),o.data("colorpicker",e),o.find("div.colorpicker_submit").bind("mouseenter",Y).bind("mouseleave",j).bind("click",T),r(e.color,o.get(0)),i(e.color,o.get(0)),n(e.color,o.get(0)),l(e.color,o.get(0)),c(e.color,o.get(0)),q(e.color,o.get(0)),d(e.color,o.get(0)),e.flat?o.css({position:"relative",display:"block"}):a(this).bind(e.eventName,E))})},showPicker:function(){return this.each(function(){a(this).data("colorpickerId")&&E.apply(this)})},hidePicker:function(){return this.each(function(){a(this).data("colorpickerId")&&a("#"+a(this).data("colorpickerId")).hide()})},setColor:function(o){if("string"==typeof o)o=x(o);else if(null!=o.r&&null!=o.g&&null!=o.b)o=w(o);else{if(null==o.h||null==o.s||null==o.b)return this;o=k(o)}return this.each(function(){var e;a(this).data("colorpickerId")&&((e=a("#"+a(this).data("colorpickerId"))).data("colorpicker").color=o,e.data("colorpicker").origColor=o,r(o,e.get(0)),i(o,e.get(0)),n(o,e.get(0)),l(o,e.get(0)),c(o,e.get(0)),q(o,e.get(0)),d(o,e.get(0)))})}};function q(e,o){a(o).data("colorpicker").currentColor.css("backgroundColor","#"+M(e))}function P(e){if(e=e.charCode||e.keyCode||-1,o<e&&e<=90||32==e)return!1;!0===a(this).parent().parent().data("colorpicker").livePreview&&s.apply(this)}function N(e){a(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus")}function S(){o=0<this.parentNode.className.indexOf("_hex")?70:65,a(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),a(this).parent().addClass("colorpicker_focus")}function O(e){var o=a(this).parent().find("input").focus(),e={el:a(this).parent().addClass("colorpicker_slider"),max:0<this.parentNode.className.indexOf("_hsb_h")?360:0<this.parentNode.className.indexOf("_hsb")?100:255,y:e.pageY,field:o,val:parseInt(o.val(),10),preview:a(this).parent().parent().data("colorpicker").livePreview};a(document).bind("mouseup",e,p),a(document).bind("mousemove",e,t)}function z(e){var o={cal:a(this).parent(),y:a(this).offset().top};o.preview=o.cal.data("colorpicker").livePreview,a(document).bind("mouseup",o,h),a(document).bind("mousemove",o,u)}function H(e){var o={cal:a(this).parent(),pos:a(this).offset()};o.preview=o.cal.data("colorpicker").livePreview,a(document).bind("mouseup",o,m),a(document).bind("mousemove",o,f)}function Y(e){a(this).addClass("colorpicker_focus")}function j(e){a(this).removeClass("colorpicker_focus")}function T(e){var o=a(this).parent(),t=o.data("colorpicker").color;o.data("colorpicker").origColor=t,q(t,o.get(0)),o.data("colorpicker").onSubmit(t,M(t),y(t),o.data("colorpicker").el,this)}function E(e){var o=a("#"+a(this).data("colorpickerId")),t=(o.data("colorpicker").onBeforeShow.apply(this,[o.get(0)]),a(this).offset()),r=(r="CSS1Compat"==document.compatMode,{l:window.pageXOffset||(r?document.documentElement:document.body).scrollLeft,t:window.pageYOffset||(r?document.documentElement:document.body).scrollTop,w:window.innerWidth||(r?document.documentElement:document.body).clientWidth,h:window.innerHeight||(r?document.documentElement:document.body).clientHeight}),i=t.top+this.offsetHeight,t=t.left;return r.t+r.h<i+176&&(i-=this.offsetHeight+176),r.l+r.w<t+356&&(t-=356),o.css({left:t+"px",top:i+"px"}),0!=o.data("colorpicker").onShow.apply(this,[o.get(0)])&&o.show(),a(document).bind("mousedown",{cal:o},v),!1}function B(e){return{r:(e=parseInt(-1<e.indexOf("#")?e.substring(1):e,16))>>16,g:(65280&e)>>8,b:255&e}}function D(){var e=a(this).parent(),o=e.data("colorpicker").origColor;e.data("colorpicker").color=o,r(o,e.get(0)),n(o,e.get(0)),i(o,e.get(0)),c(o,e.get(0)),l(o,e.get(0)),d(o,e.get(0))}a.fn.extend({ColorPicker:I.init,ColorPickerHide:I.hidePicker,ColorPickerShow:I.showPicker,ColorPickerSetColor:I.setColor})})(jQuery);