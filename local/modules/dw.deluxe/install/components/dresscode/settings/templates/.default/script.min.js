$(function(){function e(e){var t,a,r,s,i,n=$(this),o=$(e.data.containerClass+" .switcherCheckboxItems"),n=n.val();t=o,a=n,r=e.data.propertySort,s=e.data.settingName,l(t)&&E(a)&&E(r)&&E(s)?(t.parents(".switcherAjaxContainer").removeClass("hidden"),o={iblockId:a,act:"getPropertiesByIblock"},E(settingsAjaxDir)&&$.getJSON(settingsAjaxDir+"/ajax.php",o,function(e){E(e.SUCCESS)&&"Y"==e.SUCCESS?l(e.PROPERTIES)?c(t,e.PROPERTIES,r,s,a):console.log("iblockSelectAjax: properties is empty (iblockId: "+a+")"):E(e.HIDE_BLOCK)&&"Y"==e.HIDE_BLOCK?t.parents(".switcherAjaxContainer").addClass("hidden"):console.error(e)})):console.error("iblockSelectAjax: check vars"),o=e.data.settingName,e=n,n=$(".switcherCreateProductProperties"),i=$(".switcherCreateSkuProperties"),E(o)&&E(e)&&("TEMPLATE_PRODUCT_PROPERTIES[]"==o?n.data("iblock-id",e):"TEMPLATE_SKU_PROPERTIES[]"==o&&i.data("iblock-id",e))}function o(e,s){$.each(e,function(e,t){var a,r=new Array;E(t.PROPERTY_NAME)&&r.push({text:t.PROPERTY_NAME,title:t.PROPERTY_NAME,class:"switcherResultTableCell"}),E(t.PROPERTY_CODE)&&r.push({text:t.PROPERTY_CODE,title:t.PROPERTY_CODE,class:"switcherResultTableCell"}),E(t.ERROR)&&"Y"==t.ERROR?r.push({text:E(t.PROPERTY_ALLREADY_CREATED)?settingsLang.SETTINGS_PROPERTY_ALLREADY_CREATED:E($nextItem.ERROR_DATA)?$nextItem.ERROR_DATA:settingsLang.SETTINGS_PROPERTY_ERROR,title:"",class:"switcherResultTableCell error"}):E(t.SUCCESS)&&"Y"==t.SUCCESS&&r.push({text:settingsLang.SETTINGS_PROPERTY_SUCCESS_CREATED,title:"",class:"switcherResultTableCell success"}),l(r)&&(a=$("<div/>",{class:"switcherResultTableRow"}),$.each(r,function(e,t){a.append($("<div/>",{class:t.class,title:t.title}).text(t.text))}),s.append(a))})}function a(){var e=s.find("[data-dependence]");l(e)&&e.each(function(e,t){var t=$(t),a=t.data("dependence"),r=!1;"object"==typeof a&&l(a)?($.each(a,function(e,t){var e=s.find('[data-id="'+e+'"]'),a="";if(e.hasClass("switcherSelect")?a=e.val():e.hasClass("switcherBool")&&(a=e.find(".selected a").data("value")),E(a)&&a!=t)return!(r=!0)}),r?t.addClass("hidden"):t.removeClass("hidden")):E(a)&&(a=s.find('[data-id="'+a+'"]').find(".selected a").data("value"),E(a))&&("Y"==a?t.removeClass("hidden"):t.addClass("hidden"))})}function t(e){return(e=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(e[1]):void 0}var r,s=$(".txSwitcher"),i=$(".txSwitcherSettings"),n=s.find(".switcherSave"),c=function(i,e,n,o,c){var d,t;l(i)&&l(e)?E(n)&&E(o)&&E(c)?(d=0,i.empty(),$.each(e,function(e,t){var a=$("<div/>",{class:"switcherCheckboxItem"}),r=(10<++d&&a.addClass("hidden"),{class:"switcherMultiCheckItem",name:o,type:"checkbox",id:"multiCheck_"+t.ID}),r=(t.SORT<=n&&(r.checked="checked"),$("<input/>",r).val(t.ID)),s={for:"multiCheck_"+t.ID},s=$("<label/>",s).text(t.NAME+" ["+t.ID+"]"),t=(editParams={target:"_blank",class:"settingsEdit",href:"/bitrix/admin/iblock_edit_property.php?ID="+t.ID+"&IBLOCK_ID="+c},E(settingsLang)&&(editParams.title=settingsLang.SETTINGS_PROPERTY_EDIT),$("<a/>",editParams));a.append(r).append(s).append(t),i.append(a)}),10<d&&(E(settingsLang)?(e=$("<a/>",{class:"switcherShowAll",href:"#"}).text(settingsLang.SETTINGS_PROPERTY_SHOW_ALL),t=$("<a/>",{class:"switcherHideAll hidden",href:"#"}).text(settingsLang.SETTINGS_PROPERTY_HIDE_ALL),i.append(e).append(t)):console.error("reloadPropertyAjax: check component lang vars"))):console.error("reloadPropertyAjax: check property vars"):console.error("reloadPropertyAjax: check objects")},E=function(e){return void 0!==e&&""!=e},l=function(e){return void 0!==e&&!$.isEmptyObject(e)};$(document).on("click",".txSwitcherWindowExit, .switcherWindowExit",function(e){return $(".txSwitcherWindow").removeClass("opened"),window.location.reload(),e.preventDefault()}),$(document).on("click",".txSwitcherSettings, .switcherClose",function(e){var t=new Date((new Date).getTime()+366e4);return s.hasClass("opened")?(s.removeClass("opened"),i.removeClass("active"),document.cookie="switcherOpened=N; path=/; expires="+t.toUTCString()):(s.addClass("opened"),i.addClass("active"),document.cookie="switcherOpened=Y; path=/; expires="+t.toUTCString()),e.preventDefault()}),$(document).on("click",".switcherCreateProductProperties",function(e){var t=$(this),a=$(".productCreatePropertiesWindow"),r=a.find(".switcherWindowIblockData"),t=t.data("iblock-id");return a.data("iblock-id",t).addClass("opened"),r.text(t),e.preventDefault()}),$(document).on("click",".switcherCreateSkuProperties",function(e){var t=$(this),a=$(".skuCreatePropertiesWindow"),r=a.find(".switcherWindowIblockData"),t=t.data("iblock-id");return a.data("iblock-id",t).addClass("opened"),r.text(t),e.preventDefault()}),$(document).on("click",".switcherCreateCustomTheme",function(e){return $(".customThemeCreateWindow").addClass("opened"),e.preventDefault()}),$(document).on("click",".startCreateProductProperties",function(e){var r=$(this).parents(".txSwitcherWindow"),s=r.find(".switcherStartContainer"),t=r.find(".switcherErrorContainer"),i=r.find(".switcherResultContainer"),a=r.data("iblock-id");function n(e){t.removeClass("hidden"),r.removeClass("loading"),s.addClass("hidden"),E(e)&&console.error(e)}return E(a)?(r.addClass("opened loading"),a={iblockId:a,act:"createProductProperties"},E(settingsAjaxDir)?$.getJSON(settingsAjaxDir+"/ajax.php",a,function(e){var t,a;E(e.PRODUCT_PROPERTIES.SUCCESS)&&"Y"==e.PRODUCT_PROPERTIES.SUCCESS||E(e.SECTION_PROPERTIES.SUCCESS)&&"Y"==e.SECTION_PROPERTIES.SUCCESS?(t=e,i.removeClass("hidden"),r.removeClass("loading"),s.addClass("hidden"),E(t.PRODUCT_PROPERTIES.SUCCESS)&&"Y"==t.PRODUCT_PROPERTIES.SUCCESS&&l(t.PRODUCT_PROPERTIES.PROPERTY_RESULT)&&(a=$(".switcherProductResult").removeClass("hidden").find(".switcherResultTable"),o(t.PRODUCT_PROPERTIES.PROPERTY_RESULT,a)),E(t.SECTION_PROPERTIES.SUCCESS)&&"Y"==t.SECTION_PROPERTIES.SUCCESS&&l(t.SECTION_PROPERTIES.PROPERTY_RESULT)&&(a=$(".switcherSectionResult").removeClass("hidden").find(".switcherResultTable"),o(t.SECTION_PROPERTIES.PROPERTY_RESULT,a))):n(e)}):n("createProductProperties: var settingsAjaxDir not set")):n("createProductProperties: var iblockId not set"),e.preventDefault()}),$(document).on("click",".startCreateSkuProperties",function(e){var r=$(this).parents(".txSwitcherWindow"),s=r.find(".switcherStartContainer"),i=r.find(".switcherErrorContainer"),n=r.find(".switcherResultContainer"),t=r.data("iblock-id");return E(t)&&(r.addClass("opened loading"),t={iblockId:t,act:"createSkuProperties"},E(settingsAjaxDir))&&$.getJSON(settingsAjaxDir+"/ajax.php",t,function(e){var t,a;E(e.SUCCESS)&&"Y"==e.SUCCESS?(a=e,n.removeClass("hidden"),r.removeClass("loading"),s.addClass("hidden"),E(a.SUCCESS)&&"Y"==a.SUCCESS&&l(a.PROPERTY_RESULT)&&(t=$(".switcherSkuResult").removeClass("hidden").find(".switcherResultTable"),o(a.PROPERTY_RESULT,t))):(a=e,i.removeClass("hidden"),r.removeClass("loading"),s.addClass("hidden"),E(a)&&console.error(a))}),e.preventDefault()}),$(document).on("click",".startCreateCustomTheme",function(e){var t=$(this).parents(".txSwitcherWindow"),a=t.find(".switcherStartContainer"),r=t.find(".switcherErrorContainer"),s=t.find(".switcherResultContainer"),i=t.find(".switcherWindowThemeName"),n=t.find(".switcherWindowThemeReplace"),o=t.find(".switcherWindowThemeBaseColor"),c=t.find(".switcherWindowThemeBaseColorHover"),d={current:{baseColor:o.data("base-value"),baseColorHover:c.data("base-value")},replace:{baseColor:o.val(),baseColorHover:c.val()}},l=i.val(),h=!1,C=t.data("template-path"),u=t.data("current-theme"),p=t.data("current-background");return E(C)&&E(u)?(E(d.current.baseColor)&&E(d.replace.baseColor)||(o.addClass("error"),h=!0),E(d.current.baseColorHover)&&E(d.replace.baseColorHover)||(c.addClass("error"),h=!0),0==h&&d.replace.baseColorHover==d.replace.baseColor&&(c.addClass("error"),o.addClass("error"),h=!0),E(l)||(i.addClass("error"),h=!0),!1===h&&(c=1==n.prop("checked")?"Y":"N",t.addClass("opened loading"),o={colors:d,templatePath:C,currentTheme:u,currentBackground:p,replaceTheme:c,themeName:l,act:"createCustomTheme"},E(settingsAjaxDir))&&$.getJSON(settingsAjaxDir+"/ajax.php",o,function(e){E(e.SUCCESS)&&"Y"==e.SUCCESS?(s.removeClass("hidden"),t.removeClass("loading"),a.addClass("hidden")):S(e)}),e.preventDefault()):S();function S(e){return r.removeClass("hidden"),t.removeClass("loading"),a.addClass("hidden"),E(e)&&console.error(e),!1}}),$(document).on("click",".switcherHideAll",function(e){var t=$(this),a=t.parents(".switcherCheckboxItems"),r=a.find(".switcherShowAll");return a.find(".switcherCheckboxItem").slice(10).addClass("hidden"),r.removeClass("hidden"),t.addClass("hidden"),e.preventDefault()}),$(document).on("click",".switcherShowAll",function(e){var t=$(this),a=t.parents(".switcherCheckboxItems"),r=a.find(".switcherHideAll");return a.find(".switcherCheckboxItem").removeClass("hidden"),r.removeClass("hidden"),t.addClass("hidden"),e.preventDefault()}),$(document).on("click",".switchByLink a",function(e){var t=$(this);return t.parents(".switchByLink").find(".switchByLinkItem").removeClass("selected"),t.parents(".switchByLinkItem").addClass("selected"),a(),e.preventDefault()}),$(document).on("click",".switcherSave",function(e){var t;return $switcherItems=s.find(".switchByLink, .switcherFile, .switcherSelect, .switcherCheckboxItems, .switcherInputText, .switcherTextarea, .switcherInputTextB64"),ajaxFormData=new FormData,$switcherItems.each(function(e,t){var a,r,s,t=$(t),i=t.data("id").toString(),n="",o=!1;void 0!==i&&""!=i&&(t.hasClass("switchByLink")?n=t.find(".switchByLinkItem.selected a").data("value"):t.hasClass("switcherSelect")?n=t.val():t.hasClass("switcherCheckboxItems")?0<(r=t.find(".switcherMultiCheckItem:checked")).length&&(i+="[]",n=new Array,r.each(function(e,t){n.push($(t).val())})):t.hasClass("switcherFile")?(s=(r=t.find('input[type="file"]')).data("value"),E(r.val())?(n=r.prop("files")[0],o=!0):E(s)&&(n=s)):t.hasClass("switcherInputText")?(a=t.find("input"),E(a.val())&&(n=a.val())):t.hasClass("switcherTextarea")?(a=t.find("textarea"),E(a.val())&&(n=a.val())):t.hasClass("switcherInputTextB64")&&(r=(a=t.find("input")).val(),s="",E(r))&&(s=btoa(unescape(encodeURIComponent(r))),n=s)),""!=n&&""!=i&&(o||"object"!=typeof n||null===n?ajaxFormData.append(i,n):$.each(n,function(e,t){ajaxFormData.append(i,t)}))}),$.isEmptyObject(ajaxFormData)||(t=ajaxFormData,$.isEmptyObject(t))||E(settingsAjaxDir)&&(t.append("act","saveSettings"),t.append("siteId",settingsSiteId),n.addClass("loading"),$.ajax({type:"POST",url:settingsAjaxDir+"/ajax.php",enctype:"multipart/form-data",data:t,processData:!1,contentType:!1,dataType:"json",async:!1,cache:!1,success:function(e){E(e.SUCCESS)&&"Y"==e.SUCCESS?(console.log("settings successfully saved"),window.location.reload()):(n.addClass("error").removeClass("loading"),console.error("sendSettings: error"),console.error(e))},error:function(e){n.addClass("error").removeClass("loading"),console.error(e)}})),e.preventDefault()}),$(document).on("change",".productIblockSelect",{containerClass:".productPropertyAjax",propertySort:5e3,settingName:"TEMPLATE_PRODUCT_PROPERTIES[]"},e),$(document).on("change",".skuIblockSelect",{containerClass:".skuPropertyAjax",propertySort:100,settingName:"TEMPLATE_SKU_PROPERTIES[]"},e),$(document).on("change",".switcherSelect",function(e){a()}),$(document).on("click",".switcherTabs .switcherChangeTab",function(e){var t=$(this),a=$(".switcherTabs"),r=a.find(".switcherTab"),a=a.find(".switcherChangeTabItem a"),s=t.parents(".switcherChangeTabItem").index(),a=(r.removeClass("active"),a.removeClass("active"),t.addClass("active"),r.eq(s).addClass("active"),new Date((new Date).getTime()+366e4));return document.cookie="switcherActiveTabIndex="+s+"; path=/; expires="+a.toUTCString(),e.preventDefault()}),E(t("switcherActiveTabIndex"))&&(r=t("switcherActiveTabIndex"),$(".switcherTabs .switcherChangeTab").eq(r).trigger("click")),a()});