class DwProductQuickBuyForm{#options;#element=null;#closeButtons=[];#form=null;#states={};#submitButton=null;#errorsContainer=null;#orderNumberContainer=null;constructor(t={}){this.#options={selector:".product-quick-buy-form",closeButtonSelector:".product-quick-buy-form__close-button",contentSelector:".product-quick-buy-form__inner-proxy",formSelector:".product-quick-buy-form__form",stateSelector:".product-quick-buy-form__state",inputStateSelector:".product-quick-buy-form__state--input",successStateSelector:".product-quick-buy-form__state--success",submitButtonSelector:".product-quick-buy-form__submit-button",errorsContainerSelector:".product-quick-buy-form__errors",orderNumberSelector:".product-quick-buy-form__success-order-number",fieldErrorClass:"product-quick-buy-form__field--error",fieldLabelErrorClass:"product-quick-buy-form__field-label--error",activeStateClass:"product-quick-buy-form__state--active",visibleErrorClass:"product-quick-buy-form__errors--visible",submitButtonLoadingClass:"product-quick-buy-form__submit-button--loading",...t}}mount(){if(this.#element=document.querySelector(this.#options.selector),!this.#element)throw new Error(`Cannot find element with selector "${this.#options.selector}"`);if(this.#closeButtons=this.#element.querySelectorAll(this.#options.closeButtonSelector),0===this.#closeButtons.length&&console.warn(`No close buttons found with selector "${this.#options.closeButtonSelector}"`),this.#form=this.#element.querySelector(this.#options.formSelector),!this.#form)throw new Error(`Cannot find form with selector "${this.#options.formSelector}"`);if(this.#states={input:this.#element.querySelector(this.#options.inputStateSelector),success:this.#element.querySelector(this.#options.successStateSelector)},!this.#states.input||!this.#states.success)throw new Error("Cannot find required state elements");if(this.#submitButton=this.#form.querySelector(this.#options.submitButtonSelector),!this.#submitButton)throw new Error(`Cannot find submit button with selector "${this.#options.submitButtonSelector}"`);if(this.#errorsContainer=this.#element.querySelector(this.#options.errorsContainerSelector),!this.#errorsContainer)throw new Error(`Cannot find errors container with selector "${this.#options.errorsContainerSelector}"`);this.#orderNumberContainer=this.#element.querySelector(this.#options.orderNumberSelector),this.#bindEvents()}unmount(){this.#element&&(this.#unbindEvents(),this.#element.parentNode&&this.#element.parentNode.removeChild(this.#element),this.#element=null,this.#closeButtons=[],this.#form=null,this.#states={},this.#submitButton=null,this.#errorsContainer=null,this.#orderNumberContainer=null)}#bindEvents(){this.#closeButtons.forEach(t=>{t.addEventListener("click",this.#handleClose)}),document.addEventListener("keydown",this.#handleEscapeKey),this.#element.addEventListener("click",this.#handleOutsideClick),this.#form&&(this.#form.onsubmit=this.#handleSubmit)}#unbindEvents(){this.#closeButtons.forEach(t=>{t.removeEventListener("click",this.#handleClose)}),document.removeEventListener("keydown",this.#handleEscapeKey),this.#element.removeEventListener("click",this.#handleOutsideClick),this.#form&&(this.#form.onsubmit=null)}#handleClose=t=>{t.preventDefault(),this.unmount()};#handleEscapeKey=t=>{"Escape"===t.key&&this.#handleClose(t)};#handleOutsideClick=t=>{var e=this.#element.querySelector(this.#options.contentSelector);if(!e)throw new Error(`Cannot find content element with selector "${this.#options.contentSelector}"`);e.contains(t.target)||this.#handleClose(t)};#handleSubmit=async t=>{if(t.preventDefault(),this.#clearErrors(),this.#validateForm()){this.#showLoading();try{var e=new FormData(t.target),r=new URL(window.ajaxPath,window.location.origin),s=(r.searchParams.set("act","productQuickBuy"),await fetch(r,{method:"POST",body:e}));if(!s.ok&&422!==s.status)throw new Error("HTTP error! status: "+s.status);var o,i=await s.json();if(i.success)return this.#showSuccess(i.orderNumber||i.orderId),!1;i.errors&&(o=Array.isArray(i.errors)?i.errors:[i.errors],this.#showErrors(o))}catch(t){console.error("Cannot complete quick order:",t)}finally{this.#hideLoading()}}return!1};#validateForm(){let e=!0;return this.#form.querySelectorAll("[data-required='Y']").forEach(t=>{this.#validateField(t)||(this.#addFieldError(t),e=!1)}),e}#validateField(t){return"checkbox"===t.type?t.checked:""!==t.value.trim()}#addFieldError(t){"checkbox"===t.type?this.#addCheckboxLabelError(t):t.classList.add(this.#options.fieldErrorClass)}#addCheckboxLabelError(t){var e;t.parentElement&&"LABEL"===t.parentElement.tagName?t.parentElement.classList.add(this.#options.fieldLabelErrorClass):(e=t.closest("label"))?e.classList.add(this.#options.fieldLabelErrorClass):t.id&&(e=this.#form.querySelector(`label[for="${t.id}"]`))&&e.classList.add(this.#options.fieldLabelErrorClass)}#clearErrors(){[this.#options.fieldErrorClass,this.#options.fieldLabelErrorClass].forEach(e=>{this.#form.querySelectorAll("."+e).forEach(t=>{t.classList.remove(e)})}),this.#errorsContainer&&(this.#errorsContainer.innerHTML="",this.#errorsContainer.classList.remove(this.#options.visibleErrorClass))}#showLoading(){this.#submitButton&&(this.#submitButton.disabled=!0,this.#submitButton.classList.add(this.#options.submitButtonLoadingClass))}#hideLoading(){this.#submitButton&&(this.#submitButton.disabled=!1,this.#submitButton.classList.remove(this.#options.submitButtonLoadingClass))}#showSuccess(t){Object.values(this.#states).forEach(t=>{t.classList.remove(this.#options.activeStateClass)}),this.#states.success&&(this.#orderNumberContainer&&t&&(this.#orderNumberContainer.textContent=t),this.#states.success.classList.add(this.#options.activeStateClass))}#showErrors(t){this.#errorsContainer&&(this.#errorsContainer.innerHTML="",t.forEach(t=>{var e=document.createElement("div");e.className="product-quick-buy-form__error",e.textContent=t,this.#errorsContainer.appendChild(e)}),this.#errorsContainer.classList.add(this.#options.visibleErrorClass))}}