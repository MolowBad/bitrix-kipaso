BX.namespace("BX.Sale.Location.Map"),BX.Sale.Location.Map={ajaxUrl:"",interruptFlag:!1,requestFlag:!1,serviceLocationClass:"",sendRequest:function(a,s){if(a){var e=a,o=this;e.sessid=BX.bitrix_sessid(),this.requestFlag=!0,BX.ajax({timeout:300,method:"POST",dataType:"json",url:this.ajaxUrl,data:e,onsuccess:function(a){o.requestFlag=!1,o.interruptFlag?o.closeProgressDialog():(a?s&&"function"==typeof s&&s.call(null,a):o.pb.showError(BX.message("SALE_DLVRS_ADD_LOC_COMP_AJAX_ERROR")),a&&a.ERROR&&o.pb.showError(a.ERROR))},onfailure:function(a){o.requestFlag=!1,o.pb.showError("ajax onfailure"),o.pb.showError("status: "+a),o.interruptFlag&&o.closeProgressDialog()}})}},startLocationsCompare:function(a){this.showProgressDialog(),this.sendRequest({action:"locations_map",class:BX.Sale.Location.Map.serviceLocationClass,needToDeleteExist:a||!1},BX.Sale.Location.Map.processLocationsCompareAnswer)},processLocationsCompareAnswer:function(a){a&&a.stage&&a.action?(a.message&&BX.Sale.Location.Map.pb.showMessage(a.message),a.progress&&BX.Sale.Location.Map.pb.Update(a.progress),a.error?BX.Sale.Location.Map.pb.showError(a.error):a.stage&&"finish"==a.stage?BX("progress_cancel").value=BX.message("SALE_LOCATION_MAP_CLOSE"):BX.Sale.Location.Map.sendRequest({action:a.action,stage:a.stage,step:a.step?a.step:"",progress:a.progress?a.progress:0,class:BX.Sale.Location.Map.serviceLocationClass},BX.Sale.Location.Map.processLocationsCompareAnswer)):BX.Sale.Location.Map.pb.showError(BX.message("SALE_DLVRS_ADD_LOC_COMP_AJAX_ERROR"))},closeProgressDialog:function(){this.interruptFlag||(this.interruptFlag=!0),this.requestFlag||(BX.WindowManager.Get().Close(),this.interruptFlag&&(this.interruptFlag=!1))},showProgressDialog:function(){var a=new BX.CDialog({content:BX.Sale.Location.Map.pb.getNode(),width:530,height:200,draggable:!0,resizable:!0,title:BX.message("SALE_LOCATION_MAP_LOC_MAPPING"),buttons:[{title:BX.message("SALE_LOCATION_MAP_CANCEL"),id:"progress_cancel",name:"progress_cancel",action:function(){window.location.reload(),BX.Sale.Location.Map.closeProgressDialog()}}]});BX.Sale.Location.Map.pb.Init(),a.adjustSizeEx(),a.Show(),BX.Sale.Location.Map.pb.showError(""),BX.Sale.Location.Map.pb.showMessage(BX.message("SALE_LOCATION_MAP_PREPARING"))},pb:{width:0,obContainer:!1,obIndicator:!1,obIndicator2:!1,Init:function(){this.obContainer=BX("install-load-block"),this.obIndicator=BX("install-progress-bar-inner-text"),this.obIndicator2=BX("install-progress-bar-span"),this.obIndicator3=BX("install-progress-bar-inner"),this.obContainer.style.display="",this.width=this.obContainer.clientWidth||this.obContainer.offsetWidth},Update:function(a){this.obIndicator.innerHTML=this.obIndicator3.style.width=a+"%",this.obIndicator2.innerHTML=a+"%"},showError:function(a){var s=BX("install-load-error");s.innerHTML=a,s.style.display=a?"":"none",BX.WindowManager.Get().adjustSizeEx()},showMessage:function(a,s){var e=BX("install-load-label"),o=e.innerHTML;e.innerHTML=(s?o+"<br>":"")+a,e.style.display=a?"":"none",BX.WindowManager.Get().adjustSizeEx()},getNode:function(){var a=BX("install-load-block");return a||(a=BX.create("div",{props:{className:"install-load-block",id:"install-load-block"},children:[BX.create("div",{props:{className:"install-load-label",id:"install-load-label"}}),BX.create("div",{props:{className:"install-load-error",id:"install-load-error"}}),BX.create("div",{props:{className:"install-progress-bar-outer",id:"install-progress-bar-outer"},style:{width:"500px"},children:[BX.create("div",{props:{className:"install-progress-bar-alignment"},children:[BX.create("div",{props:{className:"install-progress-bar-inner",id:"install-progress-bar-inner"},style:{width:"0%"},children:[BX.create("div",{props:{className:"install-progress-bar-inner-text",id:"install-progress-bar-inner-text"},style:{width:"500px"},html:"0%"})]}),BX.create("div",{props:{className:"install-progress-bar-span",id:"install-progress-bar-span"},html:"0%"})]})]})]})),a}}};