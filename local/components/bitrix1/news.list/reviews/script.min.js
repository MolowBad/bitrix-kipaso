$(function(){function n(e,i){$(".shop-review-message-window-heading .window-heading-text").html(e),$(".shop-review-message-window-message").html(i),$(".shop-review-message-window").addClass("visible")}$(document).on("submit",".shop-review-form",function(e){var i=$(this),o=i.find('select, input[type="text"], textarea').removeClass("error"),t=i.find(".shop-review-form-submit").addClass("loading"),r=!1;return o.each(function(e,i){i=$(i);""!=i.val()&&0!=i.val()||(i.addClass("error"),r=!0)}),r?t.removeClass("loading"):$.getJSON(reviewFormAjaxDir+"/ajax.php?act=newReview&"+i.serialize(),function(e){"Y"==e.ERROR?n(reviewFormLang.errorHeading,reviewFormLang["errorTypeMessage_"+e.ERROR_TYPE]):("undefined"!=typeof globalSettings&&void 0!==globalSettings.TEMPLATE_METRICA_REVIEW_MAGAZINE&&void 0!==globalSettings.TEMPLATE_METRICA_ID&&void 0!==window["yaCounter"+globalSettings.TEMPLATE_METRICA_ID]&&window["yaCounter"+globalSettings.TEMPLATE_METRICA_ID].reachGoal(globalSettings.TEMPLATE_METRICA_REVIEW_MAGAZINE),n(reviewFormLang.successHeading,reviewFormLang.successMessage),i[0].reset()),t.removeClass("loading")}),e.preventDefault()}),$(document).on("click",".shop-review-item-utile-bad",function(e){var i=$(this);return $.getJSON(reviewFormAjaxDir+"/ajax.php?act=utileBad&id="+i.data("id")+"&iblock_id="+i.data("iblock-id"),function(e){"Y"==e.ERROR?n(reviewFormLang.errorHeading,reviewFormLang["errorTypeMessage_"+e.ERROR_TYPE]):i.find("span").html(e.VOTE_COUNT)}),e.preventDefault()}),$(document).on("click",".shop-review-item-utile-good",function(e){var i=$(this);return $.getJSON(reviewFormAjaxDir+"/ajax.php?act=utileGood&id="+i.data("id")+"&iblock_id="+i.data("iblock-id"),function(e){"Y"==e.ERROR?n(reviewFormLang.errorHeading,reviewFormLang["errorTypeMessage_"+e.ERROR_TYPE]):i.find("span").html(e.VOTE_COUNT)}),e.preventDefault()}),$(document).on("click",".shop-review-top-new-button",function(e){if(!$(this).hasClass("no-auth"))return $("html, body").animate({scrollTop:$(".shop-review-form").offset().top-150},300),e.preventDefault()}),$(document).on("focus",'select, input[type="text"], textarea',function(e){$(this).removeClass("error")}),$(document).on("click",".shop-review-message-window-exit, .shop-review-message-window-close",function(e){return $(".shop-review-message-window").removeClass("visible"),e.preventDefault()})});