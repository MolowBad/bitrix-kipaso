BX.saleOrderAjax={BXCallAllowed:!1,options:{},indexCache:{},controls:{},modes:{},properties:{},init:function(e){var t=this;this.options=e,window.submitFormProxy=BX.proxy(function(){t.submitFormProxy.apply(t,arguments)},this),BX(function(){t.initDeferredControl()}),BX(function(){t.BXCallAllowed=!0}),this.controls.scope=BX("bx-soa-order"),BX.bindDelegate(this.controls.scope,"click",{className:"-bx-popup-set-mode-add-loc"},function(){var e=BX.create("input",{attrs:{type:"hidden",name:"PERMANENT_MODE_STEPS",value:"1"}});BX.prepend(e,BX("bx-soa-order")),t.BXCallAllowed=!1,BX.Sale.OrderAjaxComponent.sendRequest()})},cleanUp:function(){for(var e in this.properties)this.properties.hasOwnProperty(e)&&(void 0!==this.properties[e].input&&(BX.unbindAll(this.properties[e].input),this.properties[e].input=null),void 0!==this.properties[e].control)&&BX.unbindAll(this.properties[e].control);this.properties={}},addPropertyDesc:function(e){this.properties[e.id]=e.attributes,this.properties[e.id].id=e.id},initDeferredControl:function(){var e,o,i,r,t,s,n,p,l,a=this;if(void 0!==window.BX.locationsDeferred)for(e in this.BXCallAllowed=!1,window.BX.locationsDeferred)window.BX.locationsDeferred[e].call(this),window.BX.locationsDeferred[e]=null,delete window.BX.locationsDeferred[e],this.properties[e].control=window.BX.locationSelectors[e],delete window.BX.locationSelectors[e];for(e in this.properties){if(this.properties[e].isZip&&(o=this.controls.scope.querySelector('[data-property-id-row="'+e+'"]'),BX.type.isElementNode(o))&&(i=o.querySelector('input[type="text"]'),BX.type.isElementNode(i))){for(t in this.properties[e].input=i,r=!1,this.properties)if("LOCATION"==this.properties[t].type){r=t;break}!1!==r&&BX.bindDebouncedChange(i,function(e){var t=BX("ZIP_PROPERTY_CHANGED");t&&(t.value="Y"),o=i=null,BX.type.isNotEmptyString(e)&&/^\s*\d+\s*$/.test(e)&&3<e.length&&a.getLocationsByZip(e,function(e){a.properties[r].control.setValueByLocationIds(e)},function(){})})}"LOCATION"==this.properties[e].type&&void 0!==this.properties[e].control&&(n=(s=this.properties[e].control).getSysCode(),void 0!==this.properties[e].altLocationPropId)&&("sls"==n&&s.replaceTemplate("nothing-found",this.options.messages.notFoundPrompt),"slst"==n)&&((e,o)=>{o.setOption("pseudoValues",["other"]),o.bindEvent("control-before-display-page",function(e){o=null;var t=e.getParentValue();t!=this.getOption("rootNodeValue")&&this.checkCanSelectItem(t)&&void 0===(t=e.getControl()).vars.cache.nodes.other&&t.fillCache([{CODE:"other",DISPLAY:a.options.messages.otherLocation,IS_PARENT:!1,VALUE:"other"}],{modifyOrigin:!0,modifyOriginPosition:"prepend"})}),p=BX("LOCATION_ALT_PROP_DISPLAY_MANUAL["+parseInt(e)+"]"),o.bindEvent("after-select-real-value",function(){BX.type.isDomNode(p)&&(p.value="0")}),o.bindEvent("after-select-pseudo-value",function(){BX.type.isDomNode(p)&&(p.value="1")}),o.bindEvent("before-set-value",function(){BX.type.isDomNode(p)&&(p.value="0")}),BX.type.isDomNode(p)&&"1"==p.value&&null!=(l=o.getAdapterAtPosition(o.getStackSize()-1))&&l.setValuePair("other",a.options.messages.otherLocation)})(e,s)}this.BXCallAllowed=!0,BX.Sale.OrderAjaxComponent&&BX.Sale.OrderAjaxComponent.locationsCompletion()},checkMode:function(e,t){if("altLocationChoosen"==t&&this.checkAbility(e,"canHaveAltLocation")){t=this.getInputByPropId(this.properties[e].altLocationPropId),e=this.properties[e].altLocationPropId;if(!1!==t&&0<t.value.length&&!t.disabled&&"default"!=this.properties[e].valueSource)return!0}return!1},checkAbility:function(e,t){if(void 0===this.properties[e]&&(this.properties[e]={}),void 0===this.properties[e].abilities&&(this.properties[e].abilities={}),void 0!==this.properties[e].abilities&&this.properties[e].abilities[t])return!0;if("canHaveAltLocation"==t&&"LOCATION"==this.properties[e].type&&void 0!==this.properties[e].altLocationPropId&&(this.properties[this.properties[e].altLocationPropId],1)){var o=this.properties[e].altLocationPropId;if(void 0!==this.properties[e].control&&"slst"==this.properties[e].control.getSysCode()&&!1!==this.getInputByPropId(o))return this.properties[e].abilities[t]=!0}return!1},getInputByPropId:function(e){if(void 0!==this.properties[e].input)return this.properties[e].input;var t=this.getRowByPropId(e);if(BX.type.isElementNode(t)){t=t.querySelector('input[type="text"]');if(BX.type.isElementNode(t))return this.properties[e].input=t}return!1},getRowByPropId:function(e){var t;return void 0!==this.properties[e].row?this.properties[e].row:(t=this.controls.scope.querySelector('[data-property-id-row="'+e+'"]'),!!BX.type.isElementNode(t)&&(this.properties[e].row=t))},getAltLocPropByRealLocProp:function(e){return void 0!==this.properties[e].altLocationPropId&&this.properties[this.properties[e].altLocationPropId]},toggleProperty:function(e,t,o){var i=this.properties[e];void 0===i.row&&(i.row=this.getRowByPropId(e)),void 0===i.input&&(i.input=this.getInputByPropId(e)),t?(o||BX.show(i.row),i.input.disabled=!1):(o||BX.hide(i.row),i.input.disabled=!0)},submitFormProxy:function(e,t){for(var o in this.properties)if(void 0!==this.properties[o].control&&this.properties[o].control==t){0;break}"other"!=e&&this.BXCallAllowed&&(this.BXCallAllowed=!1,setTimeout(function(){BX.Sale.OrderAjaxComponent.sendRequest()},20))},getPreviousAdapterSelectedNode:function(e,t){t=t.getIndex(),t=e.getAdapterAtPosition(t-1);if(void 0!==t&&null!=t){t=t.getControl().getValue();if(void 0!==t)return void 0!==(e=e.getNodeByValue(t))&&e}return!1},getLocationsByZip:function(t,o,i){var r;void 0!==this.indexCache[t]?o.apply(this,[this.indexCache[t]]):(r=this,BX.ajax({url:this.options.source,method:"post",dataType:"json",async:!0,processData:!0,emulateOnload:!0,start:!0,data:{ACT:"GET_LOCS_BY_ZIP",ZIP:t},onsuccess:function(e){e.result?(r.indexCache[t]=e.data,o.apply(r,[e.data])):i.call(r)},onfailure:function(e,t){}}))}};