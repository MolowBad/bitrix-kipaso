BX.namespace("BX.Sale.OrderAjaxComponent.Maps"),BX.Sale.OrderAjaxComponent.Maps={init:function(t){return this.context=t||{},this.pickUpOptions=this.context.options.pickUpMap,this.propsOptions=this.context.options.propertyMap,this.maxWaitTimeExpired=!1,this.scheme=this.context.isHttps?"https":"http",this.icons={red:this.scheme+"://maps.google.com/mapfiles/ms/icons/red-dot.png",green:this.scheme+"://maps.google.com/mapfiles/ms/icons/green-dot.png"},this},initializePickUpMap:function(t){var e;google&&(this.markers=[],this.bounds=new google.maps.LatLngBounds,e=t?parseFloat(BX.util.trim(t.GPS_N)):this.pickUpOptions.defaultMapPosition.lat,t=t?parseFloat(BX.util.trim(t.GPS_S)):this.pickUpOptions.defaultMapPosition.lon,this.pickUpMap=new google.maps.Map(BX("pickUpMap"),{center:{lat:e,lng:t},zoom:this.pickUpOptions.defaultMapPosition.zoom,scrollwheel:!1}),google.maps.event.addListener(this.pickUpMap,"click",BX.proxy(this.closeAllBalloons,this)))},canUseRecommendList:function(){return!1},getRecommendedStoreIds:function(t,e){return[]},getDistance:function(t,e){return!1},pickUpMapFocusWaiter:function(){this.pickUpMap&&this.markers.length?this.setPickUpMapFocus():setTimeout(BX.proxy(this.pickUpMapFocusWaiter,this),100)},setPickUpMapFocus:function(){google.maps.event.trigger(this.pickUpMap,"resize"),this.pickUpMap.fitBounds(this.bounds)},showNearestPickups:function(t,e){},buildBalloons:function(t){if(google)for(var e,s=this,i=0;i<t.length;i++)(e=new google.maps.Marker({position:{lat:parseFloat(t[i].GPS_N),lng:parseFloat(t[i].GPS_S)},map:this.pickUpMap,title:t[i].TITLE})).info=new google.maps.InfoWindow({content:"<h3>"+BX.util.htmlspecialchars(t[i].TITLE)+"</h3>"+this.getStoreInfoHtml(t[i])+'<br /><a class="btn btn-sm btn-default" data-store="'+t[i].ID+'">'+this.context.params.MESS_SELECT_PICKUP+"</a>"}),e.storeId=t[i].ID,google.maps.event.addListener(e.info,"domready",function(){var t=document.querySelector("a[data-store]");t&&BX.bind(t,"click",BX.proxy(s.selectStoreByClick,s))}),google.maps.event.addListener(e,"click",function(){s.closeAllBalloons(),this.info.open(this.getMap(),this)}),BX("BUYER_STORE").value===t[i].ID?e.setIcon(this.icons.green):e.setIcon(this.icons.red),this.markers.push(e),this.bounds.extend(e.getPosition())},selectStoreByClick:function(t){var e=t.target||t.srcElement;this.context.selectStore(e.getAttribute("data-store")),this.context.clickNextAction(t),this.closeAllBalloons()},closeAllBalloons:function(){for(var t=0;t<this.markers.length;t++)this.markers[t].info.close()},selectBalloon:function(t){if(this.pickUpMap&&this.markers&&this.markers.length)for(var e=0;e<this.markers.length;e++)this.markers[e].storeId===t?(this.markers[e].setIcon(this.icons.green),this.pickUpMap.panTo(this.markers[e].getPosition())):this.markers[e].setIcon(this.icons.red)},pickUpFinalAction:function(){},initializePropsMap:function(t){google&&(this.propsMap=new google.maps.Map(BX("propsMap"),{center:{lat:t.lat,lng:t.lon},zoom:t.zoom,scrollwheel:!1}),this.currentPropsMapCenter=this.propsMap.getCenter(),google.maps.event.addListener(this.propsMap,"click",BX.delegate(function(t){this.propsMarker?this.propsMarker.setPosition(t.latLng):(this.propsMarker=new google.maps.Marker({position:t.latLng,map:this.propsMap,draggable:!0}),this.propsMarker.addListener("drag",BX.proxy(this.onPropsMarkerChanged,this)),this.propsMarker.addListener("dragend",BX.proxy(this.onPropsMarkerChanged,this))),this.currentPropsMapCenter=t.latLng,this.onPropsMarkerChanged({latLng:t.latLng})},this)))},onPropsMarkerChanged:function(t){var e,s=BX("orderDescription",!0),i=t.latLng.lat(),t=t.latLng.lng();s&&(-1===(e=s.value.indexOf(BX.message("SOA_MAP_COORDS")+":"))?s.value=BX.message("SOA_MAP_COORDS")+": "+i+", "+t+"\r\n"+s.value:(i=BX.message("SOA_MAP_COORDS")+": "+i+", "+t,t=s.value.substring(0,e),e=s.value.substring(e+i.length),s.value=t+i+e))},propsMapFocusWaiter:function(){this.propsMap?this.setPropsMapFocus():setTimeout(BX.proxy(this.propsMapFocusWaiter,this),100)},setPropsMapFocus:function(){google.maps.event.trigger(this.propsMap,"resize"),this.propsMap.setCenter(this.currentPropsMapCenter)},getStoreInfoHtml:function(t){var e="";return t.ADDRESS&&(e+=BX.message("SOA_PICKUP_ADDRESS")+": "+BX.util.htmlspecialchars(t.ADDRESS)+"<br />"),t.PHONE&&(e+=BX.message("SOA_PICKUP_PHONE")+": "+BX.util.htmlspecialchars(t.PHONE)+"<br />"),t.SCHEDULE&&(e+=BX.message("SOA_PICKUP_WORK")+": "+BX.util.htmlspecialchars(t.SCHEDULE)+"<br />"),t.DESCRIPTION&&(e+=BX.message("SOA_PICKUP_DESC")+": "+BX.util.htmlspecialchars(t.DESCRIPTION)+"<br />"),e}};